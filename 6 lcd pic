#include <p18f4550.h>

// Configuration Bits
#pragma config FOSC = HS
#pragma config WDT = OFF
#pragma config LVP = OFF
#pragma config PBADEN = OFF

// Pin Definitions for LCD Control
#define RS PORTCbits.RC0 // Register Select
#define RW PORTCbits.RC1 // Read/Write
#define EN PORTCbits.RC2 // Enable

// Function Prototypes
void LCD_data(unsigned char data);
void LCD_cmd(unsigned char cmd);
void LCD_init();
void delay(unsigned int time);

void main() {
    // Set PORTD as output (for 8-bit data)
    TRISD = 0x00; 
    // Set PORTC bits 0, 1, 2 as output (for control)
    TRISC = 0x00; 
    
    LCD_init();   // Initialize the LCD
    
    LCD_cmd(0x80); // Command: Force cursor to 1st line, 1st position
    
    // Send characters one by one
    LCD_data('L');
    delay(25);
    LCD_data('C');
    delay(25);
    LCD_data('D');
    delay(25);
    LCD_data(' '); // Space
    delay(25);
    LCD_data('P');
    delay(25);
    LCD_data('T');
    delay(25);
    LCD_data('C');
    delay(25);
    LCD_data('1');
    delay(25);
    LCD_data('8');
    
    while (1); // Infinite loop to hold the display
}

// Function to send data (characters) to the LCD
void LCD_data(unsigned char data) {
    PORTD = data; // Put data on the data bus (PORTD)
    RS = 1;       // RS=1 for sending data
    RW = 0;       // RW=0 for writing to LCD
    EN = 1;       // Pulse the Enable pin HIGH
    delay(25);
    EN = 0;       // Pulse the Enable pin LOW (data is latched on falling edge)
}

// Function to send a command to the LCD
void LCD_cmd(unsigned char cmd) {
    PORTD = cmd;  // Put command on the data bus (PORTD)
    RS = 0;       // RS=0 for sending a command
    RW = 0;       // RW=0 for writing to LCD
    EN = 1;       // Pulse the Enable pin HIGH
    delay(25);
    EN = 0;       // Pulse the Enable pin LOW
}

// Function to initialize the LCD
void LCD_init() {
    delay(15);      // Wait for LCD to power up
    LCD_cmd(0x38);  // 8-bit mode, 2 lines, 5x7 matrix
    delay(5);
    LCD_cmd(0x01);  // Clear display
    delay(2);
    LCD_cmd(0x06);  // Increment cursor (shift cursor to right)
    delay(1t);
    LCD_cmd(0x0C);  // Display on, cursor off
    delay(1);
    LCD_cmd(0x80);  // Force cursor to beginning of first line
    delay(1);
}

// Simple delay function
void delay(unsigned int time) {
    int i, j;
    for (i=0; i < time; i++)
        for (j=0; j<275; j++); // Calibrated loop for delay
}
